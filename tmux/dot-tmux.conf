# =====================================================================
# 1. GLOBAL & PREFIX SETTINGS
# =====================================================================
# Set prefix to Ctrl-a (more ergonomic than Ctrl-b)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# General Options
set -g mouse on
set -g status-position top        # Move status bar to the top
set -g base-index 1               # Start window numbering at 1
setw -g pane-base-index 1         # Start pane numbering at 1
set -g renumber-windows on        # Automatically renumber windows
setw -g automatic-rename on       # Rename window to reflect current program
set -g history-limit 10000        # Increase scrollback buffer

# Terminal & Colors (Enable True Color Support)
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:Tc"

# Clipboard & Navigation
set -g set-clipboard on
setw -g mode-keys vi              # Use vi-style keys in copy mode

# =====================================================================
# 2. KEY BINDINGS
# =====================================================================
# Split panes with intuitive keys using current path
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Fast config reload
bind r source-file ~/.tmux.conf \; display "Reloaded tmux.conf!"

# =====================================================================
# 3. CATPPUCCIN THEME SETUP (v2 Style)
# =====================================================================
# Dynamic Theme Flavor (Syncs with SYSTEM_APPEARANCE from .zshrc)
if-shell '[ "$SYSTEM_APPEARANCE" = "light" ]' \
  'set -g @catppuccin_flavor "latte"' \
  'set -g @catppuccin_flavor "mocha"'

# Catppuccin Appearance Customization
set -g @catppuccin_window_status_style "basic"
set -g @catppuccin_window_number_position "right"
set -g @catppuccin_window_status "no"
set -g @catppuccin_window_default_text "#W"
set -g @catppuccin_window_current_fill "number"
set -g @catppuccin_window_current_text "#W"
set -g @catppuccin_window_current_color "#{E:@thm_surface_2}"
set -g @catppuccin_date_time_text " %H:%M"
set -g @catppuccin_status_module_text_bg "#{E:@thm_mantle}"

# Load Catppuccin main script (Required before customizing status line)
run '~/.tmux/plugins/tmux/catppuccin.tmux'

# Status Bar Modules Configuration
set -g status-left-length 100
set -g status-right-length 100

# Left side: Display current session name
set -g status-left "#{E:@catppuccin_status_session}"

# Right side: CPU % + Battery (Conditional) + Time
set -gF status-right "#{E:@catppuccin_status_cpu}"

set -ag status-right "#{E:@catppuccin_status_date_time}"

# =====================================================================
# 4. PLUGIN MANAGEMENT (TPM)
# =====================================================================
# Plugin List
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-cpu'      # Required for CPU % module
set -g @plugin 'tmux-plugins/tmux-battery'  # Required for Battery module
set -g @plugin 'christoomey/vim-tmux-navigator' # Navigating between Vim & Tmux
set -g @plugin 'catppuccin/tmux'            # The Theme itself

# Automatic TPM Installation on new machines
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

# Finalize and Load TPM
run '~/.tmux/plugins/tpm/tpm'
